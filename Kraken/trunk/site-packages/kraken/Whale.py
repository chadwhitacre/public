import os
from ConfigParser import RawConfigParser

class Whale:
    """A Whale represents a distribution list.

    On the filesystem, a Whale looks like a directory with three files in it:

        - config
        - to.addrs
        - from.addrs

    Kraken eat Whales for dinner.

    """

    def __init__(self, path):
        """Given a path to a directory, initialize a Whale.
        """

        conf_path = os.path.join(path, 'config')
        send_path = join(nest,'to.addrs')
        from_path = join(nest,'from.addrs')

        self.id   = os.path.split(path)[1]
        self.path = path

        cp = RawConfigParser()
        cp.read(conf_path)
        self.imap = dict(cp.items('imap'))
        self.smtp = dict(cp.items('smtp'))


        # All list members can post, as well as certain others.

        self.send_to = self.addrs(send_path)
        self.accept_from = self.send_to + \
                           self.addrs(from_path)


    def addrs(self, filename):
        """Given a filename, return a list of email addresses.
        """
        file_ = open(filename).read()
        lines = [l.strip() for l in file_.split(os.linesep)]
        file_.close()
        return [l for l in lines
                  if not l.startswith('#') and
                     not l == '']
