\section{Instant Message Commands}



\subsection{DEXP (Disable receiving instant messages)}

 DEXP sets or clears the "disable instant messages" flag.  Pass this command a
1 or 0 to respectively set or clear the flag.  When the "disable instant
messages" flag is set, no one except Aides may send the user instant messages.
Any value other than 0 or 1 will not change the flag, only report its state.
The command returns ERROR if it fails; otherwise, it returns OK followed by a
number representing the current state of the flag.



\subsection{*GEXP (Get instant messages)}

 This is a more sophisticated way of retrieving instant messages than the old
PEXP method.  If there are no instant messages waiting, PEXP returns ERROR;
otherwise, it returns LISTING_FOLLOWS and the following arguments:

 0 - a boolean value telling the client whether there are any additional
     instant messages waiting following this one
 1 - a Unix-style timestamp
 2 - flags (see server.h for more info)
 3 - the name of the sender
 4 - the node this message originated on (for future support of PIP, ICQ, etc.)

 The text sent to the client will be the body of the instant message.

 So how does the client know there are instant messages waiting?  It could
execute a random GEXP every now and then.  Or, it can check the byte in
server return code messages, between the return code and the parameters.  In
much the same way as FTP uses "-" to signify a continuation, Citadel uses
an "*" in this position to signify the presence of waiting instant messages.



\subsection{PEXP (Print instant messages) ***DEPRECATED***}

 This command is deprecated; it will eventually disappear from the protocol and
its use is not recommended.  Please use the GEXP command instead.

 Called without any arguments, PEXP simply dumps out the contents
of any waiting instant messages.  It returns ERROR if there is a problem,
otherwise it returns LISTING_FOLLOWS followed by all messages.

 So how does the client know there are instant messages waiting?  It could
execute a random PEXP every now and then.  Or, it can check the byte in
server return code messages, between the return code and the parameters.  In
much the same way as FTP uses "-" to signify a continuation, Citadel uses
an "*" in this position to signify the presence of waiting instant messages.



\subsection{SEXP (Send instant message)}

 This is one of two commands which implement instant messages (also known
as "paging").  Commands ending in "...EXP" are so-named because we called
them "express messages" before the industry standardized on the term
"instant messages."  When an instant message is sent, it will be
logged in user to another.  When an instant message is sent, it will be
displayed the next time the target user executes a PEXP or GEXP command.

 The SEXP command accepts two arguments: the name of the user to send the
message to, and the text of the message.  If the message is successfully
transmitted, OK is returned.  If the target user is not logged in or if
anything else goes wrong, ERROR is returned.

 If the server supports extended paging, sending a zero-length message
merely checks for the presence of the requested user without actually sending
a message.  Sending a message consisting solely of a "-" (hyphen) will cause
the server to return SEND_LISTING if the requested user is logged in, and the
client can then transmit a multi-line page.

 The reserved name "broadcast" may be used instead of a user name, to
broadcast an instant message to all users currently connected to the server.

 Do be aware that if an instant message is transmitted to a user who is logged
in using a client that does not check for instant messages, the message will
never be received.  Also, instant messages are NOT sent via the following
transports:  SMTP, POP3.


