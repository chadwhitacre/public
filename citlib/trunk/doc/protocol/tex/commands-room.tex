\section{Room Commands}



\subsection{CRE8 (CRE[ate] a new room)}

 This command is used to create a new room.  Like some of the other
commands, it provides a mechanism to first check to see if a room can be
created before actually executing the command.  CRE8 accepts the following
arguments:

 0  -  Create flag.  Set this to 1 to actually create the room.  If it is
set to 0, the server merely checks that there is a free slot in which to
create a new room, and that the user has enough access to create a room.  It
returns OK if the client should go ahead and prompt the user for more info,
or ERROR or ERROR+HIGHER_ACCESS_REQUIRED if the command will not succeed.
 1  -  Name for new room.
 2  -  Access type for new room:
       0  -  Public
       1  -  Private; can be entered by guessing the room's name
       2  -  Private; can be entered by knowing the name *and* password
       3  -  Private; invitation only (sometimes called "exclusive")
       4  -  Personal (mailbox for this user only)
 3  -  Password for new room (if it is a type 2 room)
 4  -  Floor number on which the room should reside (optional)
 5  -  Set to 1 to avoid automatically gaining access to the created room.
 6  -  The default "view" for the room.

 If the create flag is set to 1, the room is created (unless something
went wrong and an ERROR return is sent), and the server returns OK, but
the session is **not** automatically sent to that room.  The client still
must perform a GOTO command to go to the new room.



\subsection{EINF (Enter INFo file for room)}

 Transmit the info file for the current room with this command.  EINF uses
a boolean flag (1 or 0 as the first and only argument to the command) to
determine whether the client actually wishes to transmit a new info file, or
is merely checking to see if it has permission to do so.

 If the command cannot succeed, it returns ERROR.
 If the client is only checking for permission, and permission will be
granted, OK is returned.
 If the client wishes to transmit the new info file, SEND_LISTING is
returned, and the client should transmit the text of the info file, ended
by the usual 000 on a line by itself.



\subsection{FORG (FORGet the current room)}

 This command is used to forget (zap) the current room.  For those not
familiar with Citadel, this terminology refers to removing the room from
a user's own known rooms list, *not* removing the room itself.  After a
room is forgotten, it no longer shows up in the user's known room list,
but it will exist in the user's forgotten room list, and will return to the
known room list if the user goes to the room (in Citadel, this is
accomplished by explicitly typing the room's name in a <.G>oto command).

 The command takes no arguments.  If the command cannot execute for any
reason, ERROR will be returned.  ERROR+NOT_LOGGED_IN or ERROR+NOT_HERE may
be returned as they apply.

 If the command succeeds, OK will be returned.  At this point, the current
room is **undefined**, and the client software is responsible for taking
the user to another room before executing any other room commands (usually
this will be _BASEROOM_ since it is always there).



\subsection{GETA (GET room Aide)}

 This command is used to get the name of the Room Aide for the current room.
It will return ERROR + NOT_LOGGED_IN if no user is logged in, or OK if the
command succeeded.  Along with OK there will be returned one parameter: the
name of the Room Aide.  A conforming server must guarantee that the user is
always in some room.



\subsection{GETR (GET Room attributes)}

 This command is used for editing the various attributes associated with a
room.  A typical "edit room" command would work like this:
 1. Use the GETR command to get the current attributes
 2. Change some of them around
 3. Use SETR (see below) to save the changes
 4. Possibly also change the room aide using the GETA and SETA commands

 GETR takes no arguments.  It will only return OK if the SETR command will
also return OK.  This allows client software to tell the user that he/she
can't edit the room *before* going through the trouble of actually doing the
editing.  Possible return codes are:

 ERROR+NOT_LOGGED_IN          - No user is logged in.
 ERROR+HIGHER_ACCESS_REQUIRED - Not enough access.  Typically, only aides
and the room aide associated with the current room, can access this command.
 OK                           - Command succeeded.  Parameters are returned.

 If OK is returned, the following parameters will be returned as well:

 0. The name of the room
 1. The room's password (if it's a passworded room)
 2. The name of the room's directory (if it's a directory room)
 3. Various flags (bits) associated with the room (see LKRN cmd above)
 4. The floor number on which the room resides
 5. The room listing order
 6. The default view for the room (see views.txt)
 7. A second set of flags (bits) associated with the room



\subsection{GNET/SNET (Get/Set NETwork configuration for this room)}

 These commands get/set the network configuration for the current room.  Aide
or Room Aide privileges are required, otherwise an ERROR code is returned.
If the command succeeds, LISTING_FOLLOWS or SEND_LISTING is returned.  The
network configuration for a specific room includes neighbor nodes with whom
the room is shared, and mailing list recipients.  The format of the network
configuration is described in the file "netconfigs.txt".



\subsection{GOTO (GOTO a room)}

 This command is used to goto a new room.  When the user first logs in (login
is completed after execution of the PASS command) this command is
automatically and silently executed to take the user to the first room in the
system (usually called the Lobby).

 This command can be passed one or two parameters.  The first parameter is,
of course, the name of the room.  Although it is not case sensitive, the
full name of the room must be used.  Wildcard matching or unique string
matching of room names should be the responsibility of the client.

 Note that the reserved room name "_BASEROOM_" can be passed to the server
to cause the goto command to take the user to the first room in the system,
traditionally known as the Lobby>.   As long as a user is logged in, a
GOTO command to _BASEROOM_ is guaranteed to succeed.  This is useful to
allow client software to return to the base room when it doesn't know
where else to go.

 There are also several additional reserved room names:
 "_MAIL_" goes to the user's inbox (i.e. the Mail> room).
 "_BITBUCKET_" goes to a room that has been chosen for messages without a home.
 "_CALENDAR_" goes to the user's primary personal calendar.
 "_CONTACTS_" goes to the user's primary personal address book.
 "_NOTES_" goes to the user's primary personal notes room.
 "_TASKS_" goes to the user's primary personal task list.


 The second (and optional) parameter is a password, if one is required for
access to the room.  This allows for all types of rooms to be accessed via
this command: for public rooms, invitation-only rooms to which the user
has access, and preferred users only rooms to which the user has access, the
room will appear in a room listing.  For guess-name rooms, this command
will work transparently, adding the room to the user's known room list when
it completes.  For passworded rooms, access will be denied if the password
is not supplied or is incorrect, or the command will complete successfully
if the password is correct.

 The third (and also) optional parameter is a "transient" flag.  Normally,
when a user enters a private and/or zapped room, the room is added to the
user's known rooms list.  If the transient flag is set to non-zero, this is
called a "transient goto" which causes the user to enter the room without
adding the room to the known rooms list.

 The possible result codes are:

 OK    - The command completed successfully.  User is now in the room.
         (See the list of returned parameters below)

 ERROR - The command did not complete successfully.  Check the second and
third positions of the result code to find out what happened:

   NOT_LOGGED_IN     -  Of course you can't go there.  You didn't log in.
   PASSWORD_REQUIRED -  Either a password was not supplied, or the supplied
password was incorrect.
   ROOM_NOT_FOUND    -  The requested room does not exist.

 The typical procedure for entering a passworded room would be:

 1. Execute a GOTO command without supplying any password.
 2. ERROR + PASSWORD_REQUIRED will be returned.  The client now knows that
the room is passworded, and prompts the user for a password.
 3. Execute a GOTO command, supplying both the room name and the password.
 4. If OK is returned, the command is complete.  If, however,
ERROR + PASSWORD_REQUIRED is still returned, tell the user that the supplied
password was incorrect.  The user remains in the room he/she was previously
in.

 When the command succeeds, these parameters are returned:
   0. The name of the room
   1. Number of unread messages in this room
   2. Total number of messages in this room
   3. Info flag: set to nonzero if the user needs to read this room's info
      file (see RINF command below)
   4. Various flags associated with this room.  (See LKRN cmd above)
   5. The highest message number present in this room
   6. The highest message number the user has read in this room
   7. Boolean flag: 1 if this is a Mail> room, 0 otherwise.
   8. Aide flag: 1 if the user is either the Room Aide for this room, *or* is
a regular Aide (this makes access checks easy).
   9. The number of new Mail messages the user has (useful for alerting the
user to the arrival of new mail during a session)
  10. The floor number this room resides on
  11. The *current* "view" for this room (see views.txt for more info)
  12. The *default* "view" for this room

 The default view gives the client a hint as to what views the user should
be allowed to select.  For example, it would be confusing to allow messages
in a room intended for calendar items.  The server does not enforce these
restrictions, though.



\subsection{INVT (INViTe a user to a room)}

 This command may only be executed by Aides, or by the room aide for the
current room.  It is used primarily to add users to invitation-only rooms,
but it may also be used in other types of private rooms as well.  Its sole
parameter is the name of the user to invite.

 The command will return OK if the operation succeeded.  ERROR + NO_SUCH_USER
will be returned if the user does not exist, ERROR + HIGHER_ACCESS_REQUIRED
will be returned if the operation would have been possible if the user had
higher access, and ERROR + NOT_HERE may be returned if the room is not a
private room.



\subsection{KICK (KICK a user out of a room)}

 This is the opposite of INVT: it is used to kick a user out of a private
room.  It can also be used to kick a user out of a public room, but the
effect will only be the same as if the user <Z>apped the room - a non-stupid
user can simply un-zap the room to get back in.



\subsection{KILL (KILL current room)}

 This command deletes the current room.  It accepts a single argument, which
should be nonzero to actually delete the room, or zero to merely check
whether the room can be deleted.

 Once the room is deleted, the current room is undefined.  It is suggested
that client software immediately GOTO another room (usually _BASEROOM_)
after this command completes.

 Possible return codes:

 OK  -  room has been deleted (or, if checking only, request is valid).
 ERROR+NOT_LOGGED_IN  -  no user is logged in.
 ERROR+HIGHER_ACCESS_REQUIRED  -  not enough access to delete rooms.
 ERROR+NOT_HERE  -  this room can not be deleted.



\subsection{LKRA (List All Known Rooms)}

 Same format as LKRN.  Lists all known rooms, with or without new messages.



\subsection{LZRM (List Zapped RooMs)}

 This follows the same usage and format as LKRN.



\subsection{LKRN (List Known Rooms with New messages)}

 List known rooms with new messages.  If the client is not logged in, ERROR +
NOT_LOGGED_IN is returned.  Otherwise, LISTING_FOLLOWS is returned, followed
by the room listing.  Each line in the listing contains the full name of a
room, followed by the '|' symbol, and then a number that may contain the
following bits:

\begin{tableiii}{l|l|l}{var}{Bit}{Name}{Description}

\lineiii{1}{QR_PERMANENT}{Room does not purge}

\lineiii{4}{QR_PRIVATE}{Set for any type of private room}

\lineiii{8}{QR_PASSWORDED}{Set if there's a password too}

\lineiii{16}{QR_GUESSNAME}{Set if it's a guessname room}

\lineiii{32}{QR_DIRECTORY}{Directory room}

\lineiii{64}{QR_UPLOAD}{Allowed to upload}

\lineiii{128}{QR_DOWNLOAD}{Allowed to download}

\lineiii{256}{QR_VISDIR}{Visible directory}

\lineiii{512}{QR_ANONONLY}{Anonymous-Only room}

\lineiii{1024}{QR_ANON2}{Anonymous-Option room}

\lineiii{2048}{QR_NETWORK}{Shared network room}

\lineiii{4096}{QR_PREFONLY}{Preferred status needed to enter}

\lineiii{8192}{QR_READONLY}{Aide status required to post}

\lineiii{16384}{QR_MAILBOX}{The room exists only in your account's namespace}

\end{tableiii}

 Then it returns another '|' symbol, followed by a second set of bits comprised
of the following:

\begin{tableiii}{l|l|l}{var}{Bit}{Name}{Description}

\lineiii{1}{QR2_SYSTEM}{System room; hide by default}

\lineiii{2}{QR2_SELFLIST}{Self-service mailing list mgmt}

\end{tableiii}



 Other bits may be defined in the future.  The listing terminates, as with
all listings, with "000" on a line by itself.

 Starting with version 4.01 and above, floors are supported.  The first
argument to LKRN should be the number of the floor to list rooms from.  Only
rooms from this floor will be listed.  If no arguments are passed to LKRN, or
if the floor number requested is (-1), rooms on all floors will be listed.

 The fourth field displayed on each line is the number of the floor the room
is on.  The LFLR command should be used to associate floor numbers with
floor names.

 The fifth field displayed on each line is a "room listing order."  Unless
there is a compelling reason not to, clients should sort any received room
listings by this value.

 The sixth field is a special bit bucket containing fields which pertain to
room access controls:

\begin{tableiii}{l|l|l}{var}{Bit}{Name}{Description}

\lineiii{2}{UA_KNOWN}{Known room}

\lineiii{4}{UA_GOTOALLOWED}{Access will be granted to this room if the user
                            calls it up by name}

\lineiii{8}{UA_HASNEWMSGS}{Unread messages exist in room}

\lineiii{16}{UA_ZAPPED}{Zapped from known rooms list}

\end{tableiii}


 The sixth field is the user's current view for the room. (See VIEW command)



\subsection{LKRO (List Known Rooms with Old [no new] messages)}

 This follows the same usage and format as LKRN.



\subsection{LPRM (List all Public RooMs)}

 Again, same format.  This command lists all public rooms, and nothing else.
Unlike the other list rooms commands, this one can be executed without logging
in.



\subsection{LRMS (List all accessible RooMS)}

 Again, same format.  This command lists all accessible rooms, known and
forgotten, with and without new messages.  It does not, however, list
inaccessible private rooms.



\subsection{NSYN (Network SYNchronize room)}

 This command can be used to synchronize the contents of a room on the
network.  It is only usable by Aides.  It accepts one argument: the name of
a network node (which must be a valid one).

 When NSYN is run, the *entire* contents of the current room will be spooled
to the specified node, without regard to whether any of the messages have
already undergone network processing.  It is up to the receiving node to
check for duplicates (the Citadel networker does handle this) and avoid
posting them twice.

 The command returns OK upon success or ERROR if the user is not an Aide.



\subsection{*RDIR (Read room DIRectory)}

 Use this command to read the directory of a directory room.  ERROR + NOT_HERE
will be returned if the room has no directory, ERROR + HIGHER_ACCESS_REQUIRED
will be returned if the room's directory is not visible and the user does not
have Aide or Room Aide privileges, ERROR + NOT_LOGGED_IN will be returned if
the user is not logged in; otherwise LISTING_FOLLOWS will be returned,
followed by the room's directory.  Each line of the directory listing will
contain three fields: a filename, the length of the file, and a description.

 The server message contained on the same line with LISTING_FOLLOWS will
contain the name of the system and the name of the directory, such as:

  uncensored.citadel.org|/usr/local/citadel/files/my_room_directory



\subsection{RINF (read Room INFormation file)}

 Each room has associated with it a text file containing a description of
the room, perhaps containing its intended purpose or other important
information.  The info file for the Lobby> (the system's base room) is
often used as a repository for system bulletins and the like.

 This command, which accepts no arguments, is simply used to read the info
file for the current room.  It will return LISTING_FOLLOWS followed by
the text of the message (always in format type 0) if the request can be
honored, or ERROR if no info file exists for the current room (which is
often the case).  Other error description codes may accompany this result.

 When should this command be used?  This is, of course, up to the discretion
of client software authors, but in Citadel it is executed in two situations:
the first time the user ever enters a room; and whenever the contents of the
file change.  The latter can be determined from the result of a GOTO command,
which will tell the client whether the file needs to be read (see GOTO above).



\subsection{*SETA (SET room Aide)}

 The opposite of GETA, used to set the Room Aide for the current room.  One
parameter should be passed, which is the name of the user who is to be the
new Room Aide.  Under Citadel, this command may only be executed by Aides
and by the *current* Room Aide for the room.  Return codes possible are:
 ERROR + NOT_LOGGED_IN          (Not logged in.)
 ERROR + HIGHER_ACCESS_REQUIRED (Higher access required.)
 ERROR + NOT_HERE               (Room cannot be edited.)
 OK                             (Command succeeded.)



\subsection{*SETR (SET Room attributes)}

 This command sets various attributes associated with the current room.  It
should be passed the following arguments:

 0. The name of the room
 1. The room's password (if it's a passworded room)
 2. The name of the room's directory (if it's a directory room)
 3. Various flags (bits) associated with the room (see LKRN cmd above)
 4. "Bump" flag (see below)
 5. The floor number on which the room should reside
 6. The room listing order
 7. The default view for the room (see views.txt)
 8. A second set of flags (bits) associated with the room

 *Important: You should always use GETR to retrieve the current attributes of
the room, then change what you want to change, and then use SETR to write it
all back.  This is particularly important with respect to the flags: if a
particular bit is set, and you don't know what it means, LEAVE IT ALONE and
only toggle the bits you want to toggle.  This will allow for upward
compatibility.

 The _BASEROOM_, user's Mail> and Aide> rooms can only be partially edited.
Any changes which cannot be made will be silently ignored.

 If the room is a private room, you have the option of causing all users who
currently have access, to forget the room.  If you want to do this, set the
"bump" flag to 1, otherwise set it to 0.



\subsection{SLRP (Set Last-message-Read Pointer)}

 This command marks all messages in the current room as read (seen) up to and
including the specified number.  Its sole parameter is the number of the last
message that has been read.  This allows the pointer to be set at any
arbitrary point in the room.  Optionally, the parameter "highest" may be used
instead of a message number, to set the pointer to the number of the highest
message in the room, effectively marking all messages in the room as having
been read (ala the Citadel <G>oto command).

 The command will return OK if the pointer was set, or ERROR + NOT_LOGGED_IN
if the user is not logged in.  If OK is returned, it will be followed by a
single argument containing the message number the last-read-pointer was set to.



\subsection{VIEW (set the VIEW for a room)}

 Set the preferred view for the current user in the current room.  Please see
views.txt for more information on views.  The sole parameter for this command
is the type of view requested.  VIEW returns OK on success or ERROR on failure.



\subsection{WHOK (WHO Knows room)}

 This command is available only to Aides.  ERROR + HIGHER_ACCESS_REQUIRED
will be returned if the user is not an Aide.  Otherwise, it returns
LISTING_FOLLOWS and then lists, one user per line, every user who has
access to the current room.


