.Dd June 15, 2006
.Os
.Dt SANITY 1 LOCAL
.\"
.\"
.\"
.\"
.\"
.Sh NAME
.Nm sanity
.Nd check to see if our sites are up
.\"
.\"
.\"
.\"
.\"
.Sh SYNOPSIS
.Nm sanity
.Op Fl v
.\"
.\"
.\"
.\"
.\"
.Sh DESCRIPTION
.Nm
is a
.Xr python 1
script that determines whether a set of websites are available. It does this by
connecting via HTTP to the root of the website and interpreting the response
code according to the following heuristic:
.Bl -tag -width "all other codes" -offset indent
.It 200
success
.It 300-399
a warning
.It all other codes
an error
.El
.Pp
It is also an error if a website takes too long to respond. The list of sites to
check comes from a dbm generated by porter (a program for which there is no man
page yet).
.Nm
relies on
.Xr svn 1
to keep the local dbm in sync with the master dbm.

.Nm
also checks an IP address for
.Xr ping 8 Ns .
We currently assume that only one server
is to be checked, but that multiple websites are served from that server.

The
.Fl v
option causes
.Nm
to be verbose. If errors are found then
.Nm
is automatically verbose, and a short email is sent to an emergency email
address (assumed to be a cell phone). If given the
.Fl V
option,
.Nm
will print all verbose output, and also the names of the websites as it checks
them (rather than just dots).
.Pp
The emergency email address, the path to the local porter instance, the IP
address to check, and the length of time to wait for each website to respond are
specified in
.Pa /usr/local/etc/sanity.conf Ns , the format of which is documented at
.Xr sanity.conf 5 .
.\"
.\"
.\"
.\"
.\"
.Sh IMPLEMENTATION NOTES
This program was written with Python 2.4.
.\"
.\"
.\"
.\"
.\"
.Sh FILES
.Pa /usr/local/etc/sanity.conf
.\"
.\"
.\"
.\"
.\"
.Sh EXAMPLES
Here is an example
.Xr crontab 5 Ns :
.Bd -literal
MAILTO=admin@example.com
*/15    *       *       *       *       /usr/local/bin/sanity
45      5       *       *       *       /usr/local/bin/sanity -v
.Ed
.Pp
This would run
.Nm
quietly every 15 minutes. If errors are found,
.Nm
will send a short email to the emergency email address, and will print a full
report to
.Xr stdout 4
which will be emailed to admin@example.com. This will also email a full report
to admin@example.com every morning at 5:45, regardless of the number of errors.
.\"
.\"
.\"
.\"
.\"
.Sh SEE ALSO
.\".Xr porter 1 ,
.Xr python 1 ,
.Xr svn 1 ,
.Xr crontab 5 ,
.Xr sanity.conf 5 ,
.Xr ping 8
.\"
.\"
.\"
.\"
.\"
.Sh AUTHORS
.Bl -item -compact
.It
(c) 2005-2006 Chad Whitacre <http://www.zetaweb.com/>
.It
This program is beerware. If you like it, buy me a beer someday.
.It
No warranty is expressed or implied.
.El