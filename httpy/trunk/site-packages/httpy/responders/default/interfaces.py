from httpy._zope.interface import Interface
from httpy._zope.interface import Attribute

import httpy


class Iresponder(Interface):
    """A module that defines a Responder object.
    """

    Responder = Attribute('Responder', 'A class that implements IResponder')


class IResponder(httpy.interfaces.IResponder):
    """Represents a Responder within a tree on the filesystem.

    The data attributes described below are added to your responder dynamically
    prior to instantiation, when the server is starting up. If your class
    already has attributes by these names, then they are not overwritten.

    """

    root_fs = Attribute('root_fs', "The filesystem root of the responder.")
    root_uri = Attribute('root_uri', "The URI root of the responder.")
    root_fs_site = Attribute('root_fs_site', "The filesystem root of the " +
                                             "site in which the responder " +
                                             "is embedded.")
    __ = Attribute('__', "The site's magic directory.")


    def respond(request):
        """Given a request, raise a response.

        The incoming request object will be whatever is emitted by
        IFramework.wrap_request, and this method can raise anything that can be
        meaningfully passed to IFramework.unwrap_response.

        Using the default framework, this means that request will be an
        httpy.Request object, and respond ought to raise an httpy.Response.
        Exceptions other than httpy.Response may also be raised; they will
        generate a '500 Internal Server Error' response.

        """


class Iframework(Interface):
    """A module that defines a Framework object.
    """

    Framework = Attribute('Framework', 'A class that implements IFramework')


class IFramework(Interface):
    """A class that defines a framework.

    As with IResponder above, the two data attributes are added magically before
    instantiation, but only if they aren't already present.

    """

    root = Attribute('root', "The filesystem root of the site for which the " +
                             "framework obtains.")
    __ = Attribute('__', "The site's magic directory.")

    def wrap_request(responder, request):
        """Takes an IResponder and an IRequest.

        The object returned by this hook will be passed to your responders'
        respond method, so you can return anything meaningful to responders
        written for your framework.

        """


    def unwrap_response(responder, response):
        """Takes an IResponder and a framework-dependent response object.

        The object returned by this hook will be processed by httpy's outbound
        machinery, so you must return an IResponse implementation.

        """
