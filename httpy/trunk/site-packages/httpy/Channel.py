import logging
import traceback

from httpy._zope.server.serverchannelbase import ServerChannelBase
from httpy.Task import Task
from httpy.Request import ZopeRequest


class Channel(ServerChannelBase):
    """Represents an channel handled by asyncore.

    The httpy._zope.server machinery instantiates this for each request.

    """
    task_class = Task
    parser_class = ZopeRequest

    def __init__(self, *args, **kwargs):
        ServerChannelBase.__init__(self, *args, **kwargs)
        self.logger = logging.getLogger('httpy.Channel')

    def handle_error(self):
        self.logger.error(traceback.format_exc())
        self.close()


