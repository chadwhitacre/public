#from httpy.tests import request
#from httpy.tests import multiple

import os
import unittest

from httpy import Request as _Request
from httpy._zope.interface.exceptions import BrokenImplementation
from httpy._zope.server.adjustments import default_adj

from httpy.tests._utils import StubRequest


REQUEST_API = [ '__doc__'
              , '__init__'
              , '__module__'
              , '__repr__'
              , '__str__'
              , 'headers'
              , 'method'
              , 'path'
              , 'raw'
              , 'raw_body'
              , 'raw_headers'
              , 'raw_line'
              , 'uri'
               ]


class Request(unittest.TestCase):

    def testExtraAPIGetsStripped(self):
        stub = StubRequest(foo='bar')
        self.assert_(stub.foo == 'bar')

        request = _Request(stub)
        expected = REQUEST_API
        actual = dir(request)
        self.assertEqual(expected, actual)

    def testNotEnoughAPIGetsRejected(self):
        for name in REQUEST_API:
            if name.startswith('_'):
                continue
            stub = StubRequest()
            delattr(stub, name)
            self.assertRaises(BrokenImplementation, _Request, stub)
